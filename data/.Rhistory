cmd == "prevailingdisparities" ~ "Contesting",
cmd == "unsatisfactorytermsoftrade" ~ "Contesting",
cmd == "aliendomination" ~ "Contesting",
cmd == "selfdetermination" ~ "Contesting",
cmd == "sovereignequality" ~ "Contesting",
cmd == "subordination" ~ "Contesting",
TRUE ~ "drop"
))
contestation_data %<>% filter(contestation != "drop")
contestation_data$contestation <- factor(contestation_data$contestation, levels = c("Contesting", "Responding", "Resisting"))
# generate figure3 ----
figure3 <- contestation_data %>%
group_by(year, contestation) %>%
summarise(mean_contestation = mean(value)) %>%
ggplot(mapping = aes(x = year, y = mean_contestation, colour = contestation)) +
scale_colour_brewer(palette = "Dark2") +
geom_smooth(se=FALSE) +
geom_hline(alpha = 0.5, yintercept = 0) +
xlab("Year") +
ylab("Prevalence of Rhetorical Strategy") +
labs(col = "Rhetorical Strategy")
# print figure 3 ----
figure3
# Compute cluster membership at 3 year rolling means ----
un_roll3 <- un_long %>%
group_by(iso, year, sourcetext) %>%
mutate(iso_year_source_mean = mean(value)) %>%
select(iso,year, sourcetext, iso_year_source_mean) %>%
unique() %>%
group_by(iso, sourcetext) %>%
mutate(roll3 = rollmean(iso_year_source_mean, k = 3, fill = NA))
# 3 year ----
figure4_data <- un_roll3 %>%
drop_na() %>%
group_by(iso,year) %>%
arrange(roll3,.by_group = TRUE) %>%
mutate(sourceorder_ascending = paste(sourcetext, collapse = ",")) %>%
ungroup() %>%
select(iso,year,sourceorder_ascending) %>%
unique() %>%
mutate(cluster = case_when(
sourceorder_ascending == "nieo,brandt1,reagan" ~ "Liberals",
sourceorder_ascending == "nieo,reagan,brandt1" ~  "Hard Domesticators",
sourceorder_ascending == "reagan,nieo,brandt1"~ "Soft Domesticators",
sourceorder_ascending == "reagan,brandt1,nieo" ~ "Soft Challengers",
sourceorder_ascending == "brandt1,reagan,nieo" ~ "Hard Challengers",
sourceorder_ascending == "brandt1,nieo,reagan"~ "Conservative Challengers")) %>%
ungroup() %>%
select(iso,year,cluster) %>%
group_by(year) %>%
count(cluster) %>%
mutate(n_total = sum(n)) %>%
mutate(cluster_proportion = n/n_total)
# Add factor levels to clusters
figure4_data$cluster <- factor(figure4_data$cluster, levels = c("Liberals", "Hard Domesticators", "Soft Domesticators", "Soft Challengers", "Hard Challengers", "Conservative Challengers"))
# Generate figure 4 ----
figure4 <- figure4_data %>%
ggplot(mapping = aes(x = year, alluvium = cluster, y = cluster_proportion, fill = cluster)) +
geom_alluvium(aes(fill = cluster)) +
scale_fill_brewer(palette = "RdYlBu") +
xlab("Year") +
ylab("Proportion of Cluster Membership") +
theme_minimal() +
geom_vline(xintercept = 1976) +
geom_vline(xintercept = 1989) +
geom_vline(xintercept = 2009)
# Print figure 4 ----
figure4
# Add rhetorical strategy variable ----
treeplot_data <- un_long %>%
mutate(rhetoricalstrategy = case_when(
cmd == "domesticeconomicefficiency" ~ "Resisting",
cmd == "primaryresponsibilityfordevelopment" ~ "Resisting",
cmd == "raisingproductivity" ~ "Resisting",
cmd == "soundeconomicpolicies" ~ "Resisting",
cmd == "economicreality" ~ "Resisting",
cmd == "tradeopportunities" ~ "Resisting",
cmd == "overtaxed" ~ "Resisting",
cmd == "soundeconomic policy" ~ "Resisting",
cmd == "developmentaid" ~ "Responding",
cmd == "escapingfrompoverty" ~ "Responding",
cmd == "justandhumanesociety" ~ "Responding",
cmd == "spiritofpartnership" ~ "Responding",
cmd == "freemarketeconomy" ~ "Responding",
cmd == "privatecapitalflows" ~ "Responding",
cmd == "stimulategrowth" ~ "Responding",
cmd == "tradeopportunities" ~ "Responding",
cmd == "gapbetweenrichandpoorcountries" ~ "Contesting",
cmd == "neocolonialism" ~ "Contesting",
cmd == "prevailingdisparities" ~ "Contesting",
cmd == "unsatisfactorytermsoftrade" ~ "Contesting",
cmd == "aliendomination" ~ "Contesting",
cmd == "selfdetermination" ~ "Contesting",
cmd == "sovereignequality" ~ "Contesting",
cmd == "subordination" ~ "Contesting",
TRUE ~ "drop"
))
treeplot_data %<>% filter(rhetoricalstrategy != "drop")
treeplot_data$rhetoricalstrategy <- factor(treeplot_data$rhetoricalstrategy, levels = c("Contesting", "Responding", "Resisting"))
# Add rhetorical strategy variable with spaces ----
treeplot_data %<>%
mutate(cmd_space = case_when(
cmd == "domesticeconomicefficiency" ~ "Domestic
Economic
Efficiency",
cmd == "primaryresponsibilityfordevelopment" ~ "Primary
Responsibility
for
Development",
cmd == "raisingproductivity" ~ "Raising
Productivity",
cmd == "soundeconomicpolicies" ~ "Sound
Economic
Policies",
cmd == "economicreality" ~ "Economic
Reality",
cmd == "tradeopportunities" ~ "Trade
Opportunities",
cmd == "overtaxed" ~ "Overtaxed",
cmd == "soundeconomicpolicy" ~ "Sound
Economic
Policy",
cmd == "developmentaid" ~ "Development
Aid",
cmd == "escapingfrompoverty" ~ "Escaping
from
Poverty",
cmd == "justandhumanesociety" ~ "Just
and
Humane
Society",
cmd == "spiritofpartnership" ~ "Spirit
of
Partnership",
cmd == "freemarketeconomy" ~ "Free
Market
Economy",
cmd == "privatecapitalflows" ~ "Private
Capital
Flows",
cmd == "stimulategrowth" ~ "Stimulate
Growth",
cmd == "tradeopportunities" ~ "Trade
Opportunities",
cmd == "gapbetweenrichandpoorcountries" ~ "Gap
between
Rich
and
Poor
Countries",
cmd == "neocolonialism" ~ "Neo-colonialism",
cmd == "prevailingdisparities" ~ "Prevailing
Disparities",
cmd == "unsatisfactorytermsoftrade" ~ "Unsatisfactory
Terms
of
Trade",
cmd == "aliendomination" ~ "Alien
Domination",
cmd == "selfdetermination" ~ "Self-
determination",
cmd == "sovereignequality" ~ "Sovereign
Equality",
cmd == "subordination" ~ "Subordination"
))
# GNB
GNB_treemap <- treeplot_data %>%
filter(iso == "GNB") %>%
filter(year == 1976 | year == 1989 | year == 2009) %>%
group_by(iso, year, rhetoricalstrategy) %>%
mutate(iso_year_rhetoricalstrategy.mean = mean(value)) %>%
ggplot(mapping = aes(area = value, fill = rhetoricalstrategy,
label = cmd_space, alpha = value)) +
scale_fill_brewer(palette = "Dark2") +
geom_treemap() +
facet_wrap(vars(year)) +
geom_treemap_text(reflow = FALSE) +
labs(title = "Guinea-Bissau - Highest Prevalence Contestation Rhetoric: 1976, 1989, 2009") +
theme(legend.position="top") +
theme(plot.title = element_text(hjust = 0.5)) +
guides(fill=guide_legend(title=NULL)) +
scale_alpha(guide = 'none')
# CHN
CHN_treemap <- treeplot_data %>%
filter(iso == "CHN") %>%
filter(year == 1976 | year == 1989 | year == 2009) %>%
group_by(iso, year, rhetoricalstrategy) %>%
mutate(iso_year_rhetoricalstrategy.mean = mean(value)) %>%
ggplot(mapping = aes(area = value, fill = rhetoricalstrategy,
label = cmd_space, alpha = value)) +
scale_fill_brewer(palette = "Dark2") +
geom_treemap() +
facet_wrap(vars(year)) +
geom_treemap_text(reflow = FALSE) +
labs(title = "China - Highest Prevalence Contestation Rhetoric: 1976, 1989, 2009") +
theme(legend.position="top") +
theme(plot.title = element_text(hjust = 0.5)) +
guides(fill=guide_legend(title=NULL)) +
scale_alpha(guide = 'none')
# DNK
DNK_treemap <- treeplot_data %>%
filter(iso == "DNK") %>%
filter(year == 1976 | year == 1989 | year == 2009) %>%
group_by(iso, year, rhetoricalstrategy) %>%
mutate(iso_year_rhetoricalstrategy.mean = mean(value)) %>%
ggplot(mapping = aes(area = value, fill = rhetoricalstrategy,
label = cmd_space, alpha = value)) +
scale_fill_brewer(palette = "Dark2") +
geom_treemap() +
facet_wrap(vars(year)) +
geom_treemap_text(reflow = FALSE) +
labs(title = "Denmark - Highest Prevalence Contestation Rhetoric: 1976, 1989, 2009") +
theme(legend.position="top") +
theme(plot.title = element_text(hjust = 0.5)) +
guides(fill=guide_legend(title=NULL)) +
scale_alpha(guide = 'none')
# IND
IND_treemap <- treeplot_data %>%
filter(iso == "IND") %>%
filter(year == 1976 | year == 1989 | year == 2009) %>%
group_by(iso, year, rhetoricalstrategy) %>%
mutate(iso_year_rhetoricalstrategy.mean = mean(value)) %>%
ggplot(mapping = aes(area = value, fill = rhetoricalstrategy,
label = cmd_space, alpha = value)) +
scale_fill_brewer(palette = "Dark2") +
geom_treemap() +
facet_wrap(vars(year)) +
geom_treemap_text(reflow = FALSE) +
labs(title = "India - Highest Prevalence Contestation Rhetoric: 1976, 1989, 2009") +
theme(legend.position="top") +
theme(plot.title = element_text(hjust = 0.5)) +
guides(fill=guide_legend(title=NULL)) +
scale_alpha(guide = 'none')
# FRA
FRA_treemap <- treeplot_data %>%
filter(iso == "FRA") %>%
filter(year == 1976 | year == 1989 | year == 2009) %>%
group_by(iso, year, rhetoricalstrategy) %>%
mutate(iso_year_rhetoricalstrategy.mean = mean(value)) %>%
ggplot(mapping = aes(area = value, fill = rhetoricalstrategy,
label = cmd_space, alpha = value)) +
scale_fill_brewer(palette = "Dark2") +
geom_treemap() +
facet_wrap(vars(year)) +
geom_treemap_text(reflow = FALSE) +
labs(title = "France - Highest Prevalence Contestation Rhetoric: 1976, 1989, 2009") +
theme(legend.position="top") +
theme(plot.title = element_text(hjust = 0.5)) +
guides(fill=guide_legend(title=NULL)) +
scale_alpha(guide = 'none')
# Guinea-Bissau ----
GNB_treemap
# China ----
CHN_treemap
# Denmark ---
DNK_treemap
# India ----
IND_treemap
# France ----
FRA_treemap
# Add rhetorical strategy variable ----
treeplot_data <- un_long %>%
mutate(rhetoricalstrategy = case_when(
cmd == "domesticeconomicefficiency" ~ "Resisting",
cmd == "primaryresponsibilityfordevelopment" ~ "Resisting",
cmd == "raisingproductivity" ~ "Resisting",
cmd == "soundeconomicpolicies" ~ "Resisting",
cmd == "economicreality" ~ "Resisting",
cmd == "tradeopportunities" ~ "Resisting",
cmd == "overtaxed" ~ "Resisting",
cmd == "soundeconomic policy" ~ "Resisting",
cmd == "developmentaid" ~ "Responding",
cmd == "escapingfrompoverty" ~ "Responding",
cmd == "justandhumanesociety" ~ "Responding",
cmd == "spiritofpartnership" ~ "Responding",
cmd == "freemarketeconomy" ~ "Responding",
cmd == "privatecapitalflows" ~ "Responding",
cmd == "stimulategrowth" ~ "Responding",
cmd == "tradeopportunities" ~ "Responding",
cmd == "gapbetweenrichandpoorcountries" ~ "Contesting",
cmd == "neocolonialism" ~ "Contesting",
cmd == "prevailingdisparities" ~ "Contesting",
cmd == "unsatisfactorytermsoftrade" ~ "Contesting",
cmd == "aliendomination" ~ "Contesting",
cmd == "selfdetermination" ~ "Contesting",
cmd == "sovereignequality" ~ "Contesting",
cmd == "subordination" ~ "Contesting",
TRUE ~ "drop"
))
treeplot_data %<>% filter(rhetoricalstrategy != "drop")
treeplot_data$rhetoricalstrategy <- factor(treeplot_data$rhetoricalstrategy, levels = c("Contesting", "Responding", "Resisting"))
# Add rhetorical strategy variable with spaces ----
treeplot_data %<>%
mutate(cmd_space = case_when(
cmd == "domesticeconomicefficiency" ~ "domestic
economic
efficiency",
cmd == "primaryresponsibilityfordevelopment" ~ "primary
responsibility
for
development",
cmd == "raisingproductivity" ~ "raising
productivity",
cmd == "soundeconomicpolicies" ~ "sound
economic
policies",
cmd == "economicreality" ~ "economic
reality",
cmd == "tradeopportunities" ~ "trade
opportunities",
cmd == "overtaxed" ~ "overtaxed",
cmd == "soundeconomicpolicy" ~ "sound
economic
policy",
cmd == "developmentaid" ~ "development
aid",
cmd == "escapingfrompoverty" ~ "escaping
from
poverty",
cmd == "justandhumanesociety" ~ "just
and
humane
society",
cmd == "spiritofpartnership" ~ "spirit
of
partnership",
cmd == "freemarketeconomy" ~ "free
market
economy",
cmd == "privatecapitalflows" ~ "private
capital
flows",
cmd == "stimulategrowth" ~ "stimulate
growth",
cmd == "tradeopportunities" ~ "trade
opportunities",
cmd == "gapbetweenrichandpoorcountries" ~ "gap
between
rich
and
poor
countries",
cmd == "neocolonialism" ~ "neo-colonialism",
cmd == "prevailingdisparities" ~ "prevailing
disparities",
cmd == "unsatisfactorytermsoftrade" ~ "unsatisfactory
terms
of
trade",
cmd == "aliendomination" ~ "alien
domination",
cmd == "selfdetermination" ~ "self-
determination",
cmd == "sovereignequality" ~ "sovereign
equality",
cmd == "subordination" ~ "subordination"
))
# GNB
GNB_treemap <- treeplot_data %>%
filter(iso == "GNB") %>%
filter(year == 1976 | year == 1989 | year == 2009) %>%
group_by(iso, year, rhetoricalstrategy) %>%
mutate(iso_year_rhetoricalstrategy.mean = mean(value)) %>%
ggplot(mapping = aes(area = value, fill = rhetoricalstrategy,
label = cmd_space, alpha = value)) +
scale_fill_brewer(palette = "Dark2") +
geom_treemap() +
facet_wrap(vars(year)) +
geom_treemap_text(reflow = FALSE) +
labs(title = "Guinea-Bissau - Highest Prevalence Contestation Rhetoric: 1976, 1989, 2009") +
theme(legend.position="top") +
theme(plot.title = element_text(hjust = 0.5)) +
guides(fill=guide_legend(title=NULL)) +
scale_alpha(guide = 'none')
# CHN
CHN_treemap <- treeplot_data %>%
filter(iso == "CHN") %>%
filter(year == 1976 | year == 1989 | year == 2009) %>%
group_by(iso, year, rhetoricalstrategy) %>%
mutate(iso_year_rhetoricalstrategy.mean = mean(value)) %>%
ggplot(mapping = aes(area = value, fill = rhetoricalstrategy,
label = cmd_space, alpha = value)) +
scale_fill_brewer(palette = "Dark2") +
geom_treemap() +
facet_wrap(vars(year)) +
geom_treemap_text(reflow = FALSE) +
labs(title = "China - Highest Prevalence Contestation Rhetoric: 1976, 1989, 2009") +
theme(legend.position="top") +
theme(plot.title = element_text(hjust = 0.5)) +
guides(fill=guide_legend(title=NULL)) +
scale_alpha(guide = 'none')
# DNK
DNK_treemap <- treeplot_data %>%
filter(iso == "DNK") %>%
filter(year == 1976 | year == 1989 | year == 2009) %>%
group_by(iso, year, rhetoricalstrategy) %>%
mutate(iso_year_rhetoricalstrategy.mean = mean(value)) %>%
ggplot(mapping = aes(area = value, fill = rhetoricalstrategy,
label = cmd_space, alpha = value)) +
scale_fill_brewer(palette = "Dark2") +
geom_treemap() +
facet_wrap(vars(year)) +
geom_treemap_text(reflow = FALSE) +
labs(title = "Denmark - Highest Prevalence Contestation Rhetoric: 1976, 1989, 2009") +
theme(legend.position="top") +
theme(plot.title = element_text(hjust = 0.5)) +
guides(fill=guide_legend(title=NULL)) +
scale_alpha(guide = 'none')
# IND
IND_treemap <- treeplot_data %>%
filter(iso == "IND") %>%
filter(year == 1976 | year == 1989 | year == 2009) %>%
group_by(iso, year, rhetoricalstrategy) %>%
mutate(iso_year_rhetoricalstrategy.mean = mean(value)) %>%
ggplot(mapping = aes(area = value, fill = rhetoricalstrategy,
label = cmd_space, alpha = value)) +
scale_fill_brewer(palette = "Dark2") +
geom_treemap() +
facet_wrap(vars(year)) +
geom_treemap_text(reflow = FALSE) +
labs(title = "India - Highest Prevalence Contestation Rhetoric: 1976, 1989, 2009") +
theme(legend.position="top") +
theme(plot.title = element_text(hjust = 0.5)) +
guides(fill=guide_legend(title=NULL)) +
scale_alpha(guide = 'none')
# FRA
FRA_treemap <- treeplot_data %>%
filter(iso == "FRA") %>%
filter(year == 1976 | year == 1989 | year == 2009) %>%
group_by(iso, year, rhetoricalstrategy) %>%
mutate(iso_year_rhetoricalstrategy.mean = mean(value)) %>%
ggplot(mapping = aes(area = value, fill = rhetoricalstrategy,
label = cmd_space, alpha = value)) +
scale_fill_brewer(palette = "Dark2") +
geom_treemap() +
facet_wrap(vars(year)) +
geom_treemap_text(reflow = FALSE) +
labs(title = "France - Highest Prevalence Contestation Rhetoric: 1976, 1989, 2009") +
theme(legend.position="top") +
theme(plot.title = element_text(hjust = 0.5)) +
guides(fill=guide_legend(title=NULL)) +
scale_alpha(guide = 'none')
# Guinea-Bissau ----
GNB_treemap
# China ----
CHN_treemap
# Denmark ---
DNK_treemap
# India ----
IND_treemap
# France ----
FRA_treemap
GNB_treemap
CHN_treemap
DNK_treemap
IND_treemap
FRA_treemap
knitr::opts_chunk$set(echo = TRUE, fig.align = "center")
# Check file times to see if we need to re-cache
mtime <- function(file, ...) {
lapply(Sys.glob(c(file, ...)), function(x) file.info(x)$mtime)
}
rm(list=ls())  # Clean start, I know...
library(arrow)
pacman::p_load(arrow, curl, zip, plotly, tidyr, ggplot2, statmod, tweedie, MASS, pscl, zoo, scoringutils, openair, magrittr, countrycodes, coefplot, snow)
install.packages('BiocManager')
pacman::p_load(arrow, curl, zip, plotly, tidyr, ggplot2, statmod, tweedie, MASS, pscl, zoo, scoringutils, openair, magrittr, BiocManager,countrycodes, coefplot, snow)
pacman::p_load(arrow, curl, zip, plotly, tidyr, ggplot2, statmod, tweedie, MASS, pscl, zoo, scoringutils, openair, magrittr, BiocManager,countrycode, coefplot, snow)
# CM level data: features and outcomes path
dl_link <- "https://www.dropbox.com/scl/fo/rkj4ttawoz9pv6x35r9cq/ACi53p087OvQUke0pIg88pg/cm_level_data/cm_data_121_542.parquet?rlkey=44eg0kk4w8yh8tm1f53vvpzps&dl=1"
# File name once downloaded
destfile <- "cm_data_121_542.parquet"
# DL with curl
curl::curl_download(url = dl_link, destfile = destfile)
# This is the main data file being read into R
cm <- read_parquet("cm_data_121_542.parquet")
###
## Repeat the above with the data for the country labels and the month ids
##
# Get the list of country names as well to add to the data
# These are from the main VIEWS site
dl_link2 <- "https://www.dropbox.com/scl/fo/rurpcmtpcquni5onoyuus/AGeR6dD-Ru-Emwn06HnKAE8/matching_tables?preview=countries.csv&rlkey=v1o4va647qrwc4la7m8i7cedk&subfolder_nav_tracking=1&st=goucd0hg&dl=1"
# File name declared
destfile2 <- "country.zip"
# DL with curl
curl::curl_download(url = dl_link2, destfile = destfile2)
library(jsonlite)
library(tidyverse)
treaties_tidy <- fromJSON("C:/Users/spatt/Desktop/oxfordtreaties/post/postcorrect_tidy_8aug2025.json")
names(treaties_tidy)
head(treaties_tidy)
knitr::opts_chunk$set(echo = TRUE)
library(arrow)
df <- read_parquet("FAST-Forecast-2025-09-23.parquet")
setwd("C:/Users/spatt/Desktop/FAST_ptb/FAST-cm")
setwd("C:/Users/spatt/Desktop/FAST_ptb/FAST-cm")
library(arrow)
df <- read_parquet("FAST-Forecast-2025-09-23.parquet")
setwd("C:\Users\spatt\Desktop\FAST\data")
setwd("C:\Users\spatt\Desktop\FAST\data\")
setwd("C:/Users/spatt/Desktop/FAST/data")
library(arrow)
df <- read_parquet("FAST-Forecast-2025-09-23.parquet")
str(df)
df <- read_parquet("FAST-Forecast-2025-09-23.parquet")
#str(df)
head(df)
names(df)
#str(df)
head(df)
head(df)
names(df)
